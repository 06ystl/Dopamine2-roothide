//
//  ExploitManager.m
//  Dopamine
//
//  Created by Lars Fr√∂der on 09.01.24.
//

#import "ExploitManager.h"
#import "Exploit.h"

#import <libgrabkernel/libgrabkernel.h>

@implementation ExploitManager

+ (instancetype)sharedManager
{
    static ExploitManager *shared;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        shared = [[ExploitManager alloc] init];
    });
    return shared;
}

- (void)_loadAvailableExploits
{
    NSMutableSet *exploitSet = [NSMutableSet new];
    NSString *exploitPath = [[NSBundle mainBundle].bundlePath stringByAppendingPathComponent:@"Frameworks/Exploits"];
    NSArray *contents = [[NSFileManager defaultManager] contentsOfDirectoryAtPath:exploitPath error:nil];
    if (contents) {
        for (NSString *exploitFrameworkName in contents) {
            NSString *exploitFrameworkPath = [exploitPath stringByAppendingPathComponent:exploitFrameworkName];
            [exploitSet addObject:[[Exploit alloc] initWithPath:exploitFrameworkPath]];
        }
    }
    _allExploits = [exploitSet copy];
}

@end
